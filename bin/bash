#!/bin/bash
# NeuralChain Inference - Complete Setup Script
# Run this script to set up your entire project

echo "ðŸ§  NeuralChain Inference - Project Setup"
echo "========================================"

# Step 1: Create project directory structure
echo "ðŸ“ Creating project structure..."
mkdir -p neuralchain-inference
cd neuralchain-inference

mkdir -p api
mkdir -p frontend
mkdir -p contracts
mkdir -p ml_models
mkdir -p tests
mkdir -p docs
mkdir -p scripts
mkdir -p .github/workflows

# Step 2: Create requirements.txt for API
echo "ðŸ“¦ Creating requirements.txt..."
cat > api/requirements.txt << 'EOF'
fastapi==0.104.1
uvicorn[standard]==0.24.0
transformers==4.35.2
torch==2.1.0
pydantic==2.5.0
python-multipart==0.0.6
redis==5.0.1
psycopg2-binary==2.9.9
python-dotenv==1.0.0
pytest==7.4.3
httpx==0.25.1
EOF

# Step 3: Create .env.example
echo "ðŸ” Creating .env.example..."
cat > .env.example << 'EOF'
# API Configuration
API_HOST=0.0.0.0
API_PORT=8000
DEBUG=True

# Solana Configuration
SOLANA_RPC_URL=https://api.devnet.solana.com
SOLANA_NETWORK=devnet
CONTRACT_ADDRESS=your_contract_address_here

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/neuralchain

# Redis
REDIS_URL=redis://localhost:6379

# API Keys (if needed)
API_SECRET_KEY=your_secret_key_here
EOF

# Step 4: Create .gitignore
echo "ðŸš« Creating .gitignore..."
cat > .gitignore << 'EOF'
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
env/
venv/
ENV/
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# Environment
.env
.env.local
.env.*.local

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# Logs
*.log
logs/

# Database
*.db
*.sqlite

# Node
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Build
dist/
build/
EOF

# Step 5: Create GitHub Actions CI/CD
echo "âš™ï¸ Creating GitHub Actions workflow..."
cat > .github/workflows/ci.yml << 'EOF'
name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r api/requirements.txt
        pip install pytest pytest-cov
    
    - name: Run tests
      run: |
        pytest tests/ --cov=api --cov-report=xml
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.xml

  lint:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install linting tools
      run: |
        pip install flake8 black
    
    - name: Run linters
      run: |
        flake8 api/ --count --select=E9,F63,F7,F82 --show-source --statistics
        black --check api/
EOF

# Step 6: Create docker-compose.yml
echo "ðŸ³ Creating docker-compose.yml..."
cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  api:
    build: ./api
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://postgres:password@db:5432/neuralchain
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
    volumes:
      - ./api:/app
    command: uvicorn main:app --host 0.0.0.0 --reload

  db:
    image: postgres:15
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=neuralchain
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  postgres_data:
EOF

# Step 7: Create package.json for frontend (optional)
echo "ðŸ“¦ Creating package.json for frontend..."
cat > frontend/package.json << 'EOF'
{
  "name": "neuralchain-frontend",
  "version": "1.0.0",
  "description": "NeuralChain Inference Frontend",
  "scripts": {
    "dev": "python -m http.server 3000",
    "build": "echo 'Building frontend...'",
    "deploy": "vercel deploy"
  }
}
EOF

# Step 8: Create README.md
echo "ðŸ“ Creating README.md..."
cat > README.md << 'EOF'
# ðŸ§  NeuralChain Inference

**Democratizing AI Through Decentralized Intelligence**

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python](https://img.shields.io/badge/Python-3.9+-blue.svg)](https://www.python.org/downloads/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.104+-green.svg)](https://fastapi.tiangolo.com/)

## ðŸš€ Quick Start

### Installation

```bash
# Clone the repository
git clone https://github.com/NeuralChain-Protocol/neuralchain-inference.git
cd neuralchain-inference

# Install dependencies
pip install -r api/requirements.txt

# Set up environment
cp .env.example .env

# Run the API
cd api
uvicorn main:app --reload
```

### Usage

Visit `http://localhost:8000/docs` for interactive API documentation.

## ðŸ“š Documentation

- [API Documentation](docs/API.md)
- [Architecture](docs/ARCHITECTURE.md)
- [Contributing](CONTRIBUTING.md)

## ðŸ¤ Contributing

Contributions are welcome! Please read our [Contributing Guidelines](CONTRIBUTING.md).

## ðŸ“„ License

MIT License - see [LICENSE](LICENSE) file for details.
EOF

# Step 9: Create basic test file
echo "ðŸ§ª Creating test file..."
cat > tests/test_api.py << 'EOF'
import pytest
from fastapi.testclient import TestClient
import sys
sys.path.append('./api')
from main import app

client = TestClient(app)

def test_root():
    response = client.get("/")
    assert response.status_code == 200
    assert "NeuralChain" in response.json()["name"]

def test_health():
    response = client.get("/health")
    assert response.status_code == 200
    assert response.json()["status"] == "healthy"

def test_analyze_sentiment():
    response = client.post(
        "/api/v1/analyze",
        json={"text": "I love this!"}
    )
    assert response.status_code == 200
    assert "sentiment" in response.json()
    assert "confidence" in response.json()

def test_empty_text():
    response = client.post(
        "/api/v1/analyze",
        json={"text": ""}
    )
    assert response.status_code == 400
EOF

# Step 10: Create CONTRIBUTING.md
echo "ðŸ“– Creating CONTRIBUTING.md..."
cat > CONTRIBUTING.md << 'EOF'
# Contributing to NeuralChain

Thank you for your interest in contributing! ðŸŽ‰

## How to Contribute

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## Development Setup

```bash
# Install dependencies
pip install -r api/requirements.txt

# Run tests
pytest tests/

# Run linter
flake8 api/
```

## Code Style

- Follow PEP 8 guidelines
- Write meaningful commit messages
- Add tests for new features
- Update documentation

## Questions?

Join our [Discord](https://discord.gg/neuralchain) or open an issue!
EOF

echo ""
echo "âœ… Project setup complete!"
echo ""
echo "ðŸ“‹ Next steps:"
echo "1. cd neuralchain-inference"
echo "2. python -m venv venv"
echo "3. source venv/bin/activate  (or venv\\Scripts\\activate on Windows)"
echo "4. pip install -r api/requirements.txt"
echo "5. cd api && uvicorn main:app --reload"
echo ""
echo "ðŸŒ Visit http://localhost:8000/docs to see your API!"
echo "ðŸŽ¨ Open frontend/index.html in a browser to test the UI!"
echo ""
echo "ðŸš€ Happy coding!"
